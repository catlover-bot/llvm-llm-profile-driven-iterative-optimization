# llvm-llm-profile-driven-iterative-optimization

ã€Œâ€“O3 å¾Œã® LLVM IR ã‚’ LLM ãŒå‹•çš„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–ã‚Šè¾¼ã¿ã¤ã¤åå¾©çš„ã«æœ€é©åŒ–ã—ã€æœ€çµ‚ãƒã‚¤ãƒŠãƒªã‚’ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒãƒƒã‚°ã¾ã§è‡ªå‹•åŒ–ã™ã‚‹ã€ã‚·ã‚¹ãƒ†ãƒ 

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

1. **VSCode ã‚¿ã‚¹ã‚¯ç¾¤ (`.vscode/tasks.json`)**  
   - 1 â†’ 5 ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è‡ªå‹•å®Ÿè¡Œã™ã‚‹ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯ã‚’å®šç¾©  
     1. `clang -O3` ã§ IR å‡ºåŠ›  
     2. `perf stat` ã«ã‚ˆã‚‹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œï¼†ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—  
     3. ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«çµæœã‚’è‡ªç„¶è¨€èªã«æ•´å½¢  
     4. LLM å‘¼ã³å‡ºã—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ IR æœ€é©åŒ–ï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆï¼‹åå¾©ãƒ«ãƒ¼ãƒ—ï¼‰  
     5. æœ€é©åŒ–æ¸ˆ IR ã‹ã‚‰ãƒã‚¤ãƒŠãƒªã‚’ç”Ÿæˆ  

2. **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ•´å½¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`profile_and_parse.py`)**  
   - `perf stat` ã®å‡ºåŠ›ï¼ˆcycles, instructions, cache-misses ãªã©ï¼‰ã‚’ãƒ‘ãƒ¼ã‚¹  
   - ã€Œãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€ã¨ã—ã¦ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã«å¤‰æ›  

3. **LLM æœ€é©åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`optimize_ir_llm.py`)**  
   - å…¥åŠ›ï¼šå…ƒã® IR ãƒ†ã‚­ã‚¹ãƒˆ ï¼‹ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ  
   - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã€Œâ€“O3 ä»¥ä¸Šã«æœ€é©åŒ–ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆã«æ³¨ç›®ã—ã¦â€¦ã€ã¨æŒ‡ç¤º  
   - `--iterations` å›ã ã‘ï¼ˆä¾‹ï¼š3 ã‚µã‚¤ã‚¯ãƒ«ï¼‰å‘¼ã³å‡ºã—â†’é€æ¬¡ IR ã‚’æ›´æ–°  
   - æœ€çµ‚çš„ã«æœ€é©åŒ– IR ã‚’ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›  

4. **ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒãƒƒã‚°è¨­å®š (`.vscode/launch.json`)**  
   - æœ€çµ‚ãƒã‚¤ãƒŠãƒªã®ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œã‚„ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã«ã‚ˆã‚‹å‹•ä½œæ¤œè¨¼ã‚’ VSCode å†…ã§å®Œçµ  

ã“ã®ä¸€é€£ã‚’ â€œ`Ctrl+Shift+B`â€ ã®ä¸€ç™ºæ“ä½œã§å‹•ã‹ã›ã‚‹ã®ãŒæœ€å¤§ã®ç‰¹å¾´

---

## æ–°è¦æ€§

1. **åå¾©ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ«ãƒ¼ãƒ—ã®è‡ªå‹•åŒ–**  
   - ãŸã ä¸€åº¦ LLM ã‚’å‘¼ã¶ã®ã§ã¯ãªãã€æ€§èƒ½è©•ä¾¡â†’çµæœãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯â†’å†æœ€é©åŒ–ã‚’è¤‡æ•°ã‚µã‚¤ã‚¯ãƒ«ã§è‡ªå‹•å®Ÿè¡Œ  
   - ã‚µã‚¤ã‚¯ãƒ«ã”ã¨ã®æ€§èƒ½æ¨ç§»ã‚’å®šé‡çš„ã«å–å¾—ã§ãã€LLM ã®æœ€é©åŒ–åæŸç‰¹æ€§ã‚’åˆã‚ã¦å¯è¦–åŒ–ãƒ»åˆ†æå¯èƒ½

2. **å‹•çš„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆ**  
   - é™çš„ IR ã ã‘ã§ãªãã€å®Ÿè¡Œæ™‚ã®ãƒ›ãƒƒãƒˆã‚¹ãƒãƒƒãƒˆæƒ…å ±ï¼ˆperf çµ±è¨ˆï¼‰ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«çµ„ã¿è¾¼ã¿  
   - ã€Œå®Ÿè¡Œãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«Ã—ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ§‹é€ ã€ã®ã‚¯ãƒ­ã‚¹ãƒ¢ãƒ¼ãƒ€ãƒ«æœ€é©åŒ–ã‚’ LLM ã«å­¦ç¿’ã•ã›ã‚‹ã“ã¨ã§ã€å¾“æ¥ã®é™çš„æœ€é©åŒ–æ‰‹æ³•ã‚„å˜ä¸€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–ã‚’ä¸Šå›ã‚‹ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’å®Ÿç¾

3. **VSCode ã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹çµ±åˆ**  
   - é–‹ç™ºè€…ãŒé¦´æŸ“ã¿æ·±ã„ IDE ä¸Šã§ã€æœ€é©åŒ–ãƒ•ãƒ­ãƒ¼å…¨ä½“ã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯è‡ªå‹•åŒ–  
   - å­¦è¡“å®Ÿé¨“ç’°å¢ƒã¨ã—ã¦ã ã‘ã§ãªãã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å®Ÿé–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚‚è‡ªç„¶ã«çµ„ã¿è¾¼ã‚ã‚‹æ±ç”¨æ€§ã‚’å…¼å‚™






[Cã‚½ãƒ¼ã‚¹]   
   â†“  
[clang -O3 -emit-llvm]  
   â†“  
[LLVM IR (.ll)]  
   â†“  
[perf stat å®Ÿè¡Œ]  
   â†“  
[ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ› (.prof.txt)]  
   â†“  
[profile_and_parse.py â†’ .prof.md]  
   â†“  
[optimize_ir_llm.py Ã— Nå›åå¾©]  
   â†“  
[æœ€çµ‚IR (.opt.ll)]  
   â†“  
[clang â†’ .opt.final]  
   â†“  
[å†åº¦ perf stat]  
   â†“  
[diff_stats.py â†’ .csv]  
   â†“  
[ã‚°ãƒ©ãƒ•å‡ºåŠ› â†’ .png]  


---

## ğŸŸ© **STEP 1: Cãƒ•ã‚¡ã‚¤ãƒ«ã‚’LLVM IRã«å¤‰æ›ã™ã‚‹**

### ğŸ”§ å‡¦ç†å†…å®¹
- `clang` ã‚’ä½¿ã£ã¦ `.c` â†’ `.ll` ã«å¤‰æ›ï¼ˆ`-emit-llvm -S`ï¼‰
- `-O3` ã§æ—¢ã«é«˜ãƒ¬ãƒ™ãƒ«æœ€é©åŒ–ã‚’é©ç”¨æ¸ˆ

### ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
clang -O3 -DPOLYBENCH_TIME -emit-llvm -S gemm.c -o gemm.ll
```

### ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
- `gemm.ll`ï¼šäººé–“ãŒèª­ã‚ã‚‹ä¸­é–“ã‚³ãƒ¼ãƒ‰ï¼ˆLLVM IRï¼‰

---

## ğŸŸ© **STEP 2: LLVM IR ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã«ãƒ“ãƒ«ãƒ‰ & å®Ÿè¡Œã—ã¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åé›†**

### ğŸ”§ å‡¦ç†å†…å®¹
- `gemm.ll` ã‚’å®Ÿè¡Œå¯èƒ½ãªãƒã‚¤ãƒŠãƒªã«å¤‰æ›
- `perf stat` ã§æ€§èƒ½ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå®Ÿè¡Œæ™‚é–“ãƒ»å‘½ä»¤æ•°ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹ãªã©ï¼‰

### ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
clang gemm.ll -o gemm.opt
perf stat -d ./gemm.opt > gemm.prof.txt
```

### ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
- `gemm.opt`ï¼šå®Ÿè¡Œç”¨ãƒã‚¤ãƒŠãƒª
- `gemm.prof.txt`ï¼šå®Ÿè¡Œæ€§èƒ½ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆcycles, instructions, cache-misses ãªã©ï¼‰

---

## ğŸŸ© **STEP 3: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’LLMå‘ã‘è‡ªç„¶è¨€èªã«æ•´å½¢**

### ğŸ”§ å‡¦ç†å†…å®¹
- `profile_and_parse.py` ãŒ `gemm.prof.txt` ã‚’èª­ã¿å–ã‚Š
- æ•°å€¤ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’äººé–“ï¼ˆLLMï¼‰ãŒèª­ã‚ã‚‹è‡ªç„¶è¨€èªã«å¤‰æ›

### ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
python3 scripts/profile_and_parse.py \
  --input gemm.prof.txt \
  --output gemm.prof.md
```

### ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
- `gemm.prof.md`ï¼ˆä¾‹ï¼‰:
  ```markdown
  ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«:
  - cycles: 134567
  - instructions: 204023
  - cache-misses: 343
  ```

---

## ğŸŸ© **STEP 4: LLMã«ã‚ˆã‚‹IRæœ€é©åŒ–ï¼ˆåå¾©å®Ÿè¡Œï¼‰**

### ğŸ”§ å‡¦ç†å†…å®¹
- `optimize_ir_llm.py` ãŒ `.ll` ã¨ `.prof.md` ã‚’ LLM ã«æ¸¡ã™
- Nå›ï¼ˆä¾‹: 3å›ï¼‰æœ€é©åŒ–ã‚’ç¹°ã‚Šè¿”ã™ï¼ˆå‰å›ã®å‡ºåŠ›ãŒæ¬¡ã®å…¥åŠ›ã«ï¼‰

### ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
python3 scripts/optimize_ir_llm.py \
  --input gemm.ll \
  --profile gemm.prof.md \
  --iterations 3 \
  --output gemm.opt.ll
```

### ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ï¼‰
- `gemm.opt.ll`ï¼šæœ€çµ‚çš„ãªæœ€é©åŒ–IR
- `metrics_log.json`ï¼šå„iterationã® `cycles`, `cache-miss`, `IRè¡Œæ•°`
- `ir_instr_log.json`ï¼šå‘½ä»¤ç¨®é¡ã®å‡ºç¾æ•°

---

## ğŸŸ© **STEP 5: LLMæœ€é©åŒ–æ¸ˆIR â†’ å®Ÿè¡Œãƒã‚¤ãƒŠãƒªã«ãƒ“ãƒ«ãƒ‰**

### ğŸ”§ å‡¦ç†å†…å®¹
- `.opt.ll` ã‚’ `clang` ã§ãƒã‚¤ãƒŠãƒªåŒ–

### ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
clang gemm.opt.ll -o gemm.opt.final
```

### ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
- `gemm.opt.final`ï¼šæœ€çµ‚æœ€é©åŒ–æ¸ˆã¿ãƒã‚¤ãƒŠãƒª

---

## ğŸŸ© **STEP 6: æœ€é©åŒ–å¾Œãƒã‚¤ãƒŠãƒªã®æ€§èƒ½æ¸¬å®š**

### ğŸ”§ å‡¦ç†å†…å®¹
- `perf stat` ã§æœ€é©åŒ–å¾Œã®æ€§èƒ½ã‚’å†æ¸¬å®š

### ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
perf stat -d ./gemm.opt.final > gemm.opt.prof.txt
```

### ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
- `gemm.opt.prof.txt`ï¼šæœ€é©åŒ–å¾Œã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

---

## ğŸŸ© **STEP 7: æœ€é©åŒ–åŠ¹æœã®å®šé‡è©•ä¾¡ï¼ˆå·®åˆ†æ¯”è¼ƒï¼‰**

### ğŸ”§ å‡¦ç†å†…å®¹
- `diff_stats.py` ã«ã‚ˆã‚Š before / after ã®å·®åˆ†ã‚’ `CSV` ã«å‡ºåŠ›

### ğŸ› ï¸ ã‚³ãƒãƒ³ãƒ‰ä¾‹
```bash
python3 scripts/diff_stats.py \
  --original_perf gemm.prof.txt \
  --optimized_perf gemm.opt.prof.txt \
  --original_ir gemm.ll \
  --optimized_ir gemm.opt.ll \
  --kernel gemm \
  --output_csv optimization_report.csv
```

### ğŸ“„ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«
- `optimization_report.csv`ï¼š
  ```csv
  kernel,orig_cycles,opt_cycles,Î”cycles(%),...,Î”IR_lines(%)
  gemm,134567,112345,-16.5,...,-23.1
  ```

---

## ğŸŸ© **STEP 8: ã‚°ãƒ©ãƒ•ã¨ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã«ã‚ˆã‚‹å¯è¦–åŒ–**

### âœ… ã‚°ãƒ©ãƒ•ï¼ˆå…¨ã‚«ãƒ¼ãƒãƒ«æ¯”è¼ƒï¼‰

```bash
make plot
```

- `report_cycles.png`
- `report_cache.png`
- `report_ir_lines.png`

### âœ… ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼ˆå‘½ä»¤ç¨®é¡ã®å¤‰åŒ–ï¼‰

```bash
make heatmap
```

- `ir_instr_heatmap.png`

---


---

# âœ… å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã®é–¢ä¿‚ã€å®Œå…¨å¯¾å¿œè¡¨ã€‘

| ãƒ•ã‚¡ã‚¤ãƒ«å | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã®ä½ç½® | æ©Ÿèƒ½æ¦‚è¦ |
|------------|------------------------|-----------|
| **`batch_optimize_all.sh`** | ğŸ’¥å…¨ä½“ã®ãƒã‚¹ã‚¿ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼1ã€œ7ã™ã¹ã¦åˆ¶å¾¡ï¼‰ | PolyBenchã®å„ `.c` ã«å¯¾ã—ã¦ O3 â†’ perf â†’ LLMæœ€é©åŒ– â†’ å†perf â†’ è©•ä¾¡ãƒ­ã‚° |
| **`profile_and_parse.py`** | ğŸ“STEP 3 | perfå‡ºåŠ›ï¼ˆ`*.prof.txt`ï¼‰ã‚’ LLMãŒèª­ã‚ã‚‹è‡ªç„¶è¨€èª (`*.prof.md`) ã«å¤‰æ› |
| **`optimize_ir_llm.py`** | ğŸ“STEP 4ï¼ˆæ ¸ï¼‰| LLMã«IRã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¸¡ã—ã¦åå¾©æœ€é©åŒ–ï¼‹IRè¡Œæ•°/å‘½ä»¤/ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å¤‰åŒ–ã‚’è¨˜éŒ² |
| **`diff_stats.py`** | ğŸ“STEP 7 | æœ€é©åŒ–å‰å¾Œã®IRè¡Œæ•° / cycles / cache-missã‚’æ¯”è¼ƒã—ã€`optimization_report.csv` ã«è¨˜éŒ² |
| **`generate_iteration_plot.py`** | ğŸ“STEP 8a | å„iterationã® `cycles`, `cache-misses`, `IRè¡Œæ•°` ã‚’ãƒ—ãƒ­ãƒƒãƒˆï¼ˆæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼‰ |
| **`generate_instr_heatmap.py`** | ğŸ“STEP 8b | å„iterationã”ã¨ã®å‘½ä»¤ç¨®ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—åŒ–ï¼ˆ`ir_instr_log.json`ã‚’ä½¿ç”¨ï¼‰ |
| **`generate_report.py`** | ğŸ“STEP 8c | `optimization_report.csv` ã® before/after ã‚’æ£’ã‚°ãƒ©ãƒ•åŒ–ï¼ˆ3ç¨®ï¼‰ |
| **`launch.json`** | ğŸ§ªãƒ‡ãƒãƒƒã‚° | VSCodeã‹ã‚‰ `optimize_ir_llm.py` ã¾ãŸã¯ `.opt` ãƒã‚¤ãƒŠãƒªã‚’ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ |
| **`tasks.json`** | âš™ï¸ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯ | VSCodeã§ Ctrl+Shift+B ã«ã‚ˆã‚‹5æ®µéšã®IRæœ€é©åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æ§‹æˆ |
| **`Makefile`** | ğŸ§ CLIè‡ªå‹•åŒ– | `make all-optimize / report / plot / heatmap` ã«ã‚ˆã‚Šå„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å‘¼ã³å‡ºã—ã‚’å¯èƒ½ã« |

---

## ğŸ” å„ãƒ•ã‚¡ã‚¤ãƒ«ãŒé–¢ä¸ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ãƒãƒƒãƒ”ãƒ³ã‚°

| ã‚¹ãƒ†ãƒƒãƒ— | é–¢ä¸ãƒ•ã‚¡ã‚¤ãƒ« | å‡¦ç†å†…å®¹ |
|---------|--------------|-----------|
| STEP 1 | `batch_optimize_all.sh`ãƒ»`tasks.json` | `.c â†’ .ll` å¤‰æ›ï¼ˆO3ï¼‰ |
| STEP 2 | `batch_optimize_all.sh` | `.ll â†’ .opt` ãƒã‚¤ãƒŠãƒªåŒ– + `perf` å®Ÿè¡Œ |
| STEP 3 | `profile_and_parse.py` | `perf` å‡ºåŠ› â†’ `.prof.md`ï¼ˆLLMãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåŒ–ï¼‰ |
| STEP 4 | `optimize_ir_llm.py` | LLMã«ã‚ˆã‚‹IRæœ€é©åŒ–ï¼ˆåå¾©ã‚ã‚Šï¼‰ã€ä¸­é–“ãƒ‡ãƒ¼ã‚¿å‡ºåŠ› |
| STEP 5 | `batch_optimize_all.sh`ãƒ»`tasks.json` | `.opt.ll â†’ .opt.final` ãƒ“ãƒ«ãƒ‰ |
| STEP 6 | `batch_optimize_all.sh` | å† `perf` è¨ˆæ¸¬ |
| STEP 7 | `diff_stats.py` | æœ€é©åŒ–å‰å¾Œã®å·®åˆ†ã‚’ `.csv` ã«è¨˜éŒ² |
| STEP 8a | `generate_iteration_plot.py` | iterationã”ã¨ã®å¤‰åŒ–ã‚’ã‚°ãƒ©ãƒ•åŒ– |
| STEP 8b | `generate_instr_heatmap.py` | å‘½ä»¤ç¨®ã®å¤‰åŒ–ã‚’ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã§å¯è¦–åŒ– |
| STEP 8c | `generate_report.py` | å„kernelã®before/afterå·®ã‚’æ£’ã‚°ãƒ©ãƒ•å‡ºåŠ› |

---

## ğŸ¯ ä¾‹ï¼š`gemm.c` ã§èµ·ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å¤‰åŒ–ãƒ•ãƒ­ãƒ¼

```txt
gemm.c
  â†“ clang -O3
gemm.ll
  â†“ clang
gemm.opt
  â†“ perf stat
gemm.prof.txt
  â†“ profile_and_parse
gemm.prof.md
  â†“ optimize_ir_llm (3å›åå¾©)
gemm.opt.ll
  â†“ clang
gemm.opt.final
  â†“ perfå†å®Ÿè¡Œ
gemm.opt.prof.txt
  â†“ diff_stats
optimization_report.csv ï¼ˆã«è¿½è¨˜ï¼‰

metrics_log.json       â† iterationã”ã¨ã® perf & IRå¤‰åŒ–
ir_instr_log.json      â† å‘½ä»¤ç¨®å¤‰åŒ–ï¼ˆãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‰
```

---

## âœ… è£œè¶³ï¼šã©ã®å‡ºåŠ›ãŒã©ã®å¯è¦–åŒ–ã«ä½¿ã‚ã‚Œã‚‹ã‹

| å¯è¦–åŒ–å | ä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|----------|--------------|------|
| `report_cycles.png` | `optimization_report.csv` | å„kernelã® before/after cycles |
| `report_cache.png` | åŒä¸Š | cache-miss before/after |
| `report_ir_lines.png` | åŒä¸Š | IRè¡Œæ•° before/after |
| `iteration_optimization_report.png` | `metrics_log.json` | å„iterationã®å¤‰åŒ–ï¼ˆæŠ˜ã‚Œç·š3ç¨®ï¼‰ |
| `ir_instr_heatmap.png` | `ir_instr_log.json` | å‘½ä»¤ç¨®é¡ Ã— iterationï¼ˆãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‰ |

---
ã“ã‚Œã‹ã‚‰è¿½åŠ ã—ã‚
- ã‚ªãƒªã‚¸ãƒŠãƒ« vs LLMæœ€é©åŒ–å¾Œ vs iterationå›æ•°ã”ã¨ã®å®Ÿè¡Œæ™‚é–“ã®å·®
- å‡¦ç†å†…å®¹ãŒä¸€è‡´ã™ã‚‹ã‹ç¢ºèªã—ãªã„ã¨ã„ã‘ã‚“ã‚„ã‚“
